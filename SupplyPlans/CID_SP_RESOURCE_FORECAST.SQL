DROP TABLE WARM01.CID_SP_RESOURCE_FORECAST;
CREATE TABLE WARM01.CID_SP_RESOURCE_FORECAST AS
SELECT 
  INVESTMENTS.ID||TO_CHAR(PLAN_VALUES.SLICE_DATE,'YYYYMM') UUID,
  INVESTMENTS.ID INVESTMENT_ID,
  PROJECT_FINANCIALS.CLASS PROJECTCLASS,
  PROJECT_FINANCIALS.WIPCLASS,
  PROJECT_FINANCIALS.COMPANY_CODE CLIENTCLASS,
  RESOURCES.UNIQUE_NAME RESOURCE_CODE,
  OBSUNIT.UNIQUE_NAME CC,
  RESOURCES.IS_EXTERNAL,
  RESOURCE_DETAILS.PRISROLE ISROLE,
  RESOURCE_DETAILS.PRUSERTEXT1,
  RESOURCE_DETAILS.PRUSERTEXT2,
  RESOURCE_DETAILS.PRUSERTEXT3,
  RESOURCE_DETAILS.PRUSERTEXT4,
  PLAN_VALUES.SLICE_DATE DATE_VAL,
  TO_CHAR(PLAN_VALUES.SLICE_DATE,'YYYYMM') DATE_UID,
  SUM(PLAN_VALUES.SLICE) AMOUNT
FROM 
  WARM01.PRJ_BLB_SLICES_M_HARDALC PLAN_VALUES,
  WARM01.INV_INVESTMENTS INVESTMENTS,
  WARM01.PAC_MNT_PROJECTS PROJECT_FINANCIALS,
  WARM01.PRTEAM TEAMS,
  WARM01.SRM_RESOURCES RESOURCES,
  WARM01.PRJ_RESOURCES RESOURCE_DETAILS,
  (SELECT O.LINKED_UNIT_ID, O.UNIQUE_NAME, O.NAME
     FROM OBS_UNITS_V O, PRJ_OBS_TYPES T
    WHERE     O.TYPE_ID = T.ID
          AND O.DEPTH = 5
          AND O.UNIT_MODE = 'OBS_UNIT_AND_ANCESTORS'
          AND T.ID = 5000001
    GROUP BY O.LINKED_UNIT_ID, O.UNIQUE_NAME, O.NAME) OBSUNIT
WHERE 
  PLAN_VALUES.INVESTMENT_ID = INVESTMENTS.ID
  AND PLAN_VALUES.INVESTMENT_ID = PROJECT_FINANCIALS.ID(+)
  AND PLAN_VALUES.PRJ_OBJECT_ID = TEAMS.PRID
  AND TEAMS.PRRESOURCEID = RESOURCES.ID
  AND TEAMS.RSF_OBSUNIT_ID = OBSUNIT.LINKED_UNIT_ID(+)
  AND RESOURCES.ID = RESOURCE_DETAILS.PRID
GROUP BY
  INVESTMENTS.ID,
  PROJECT_FINANCIALS.CLASS,
  PROJECT_FINANCIALS.WIPCLASS,
  PROJECT_FINANCIALS.COMPANY_CODE,
  RESOURCES.UNIQUE_NAME,
  OBSUNIT.UNIQUE_NAME,
  RESOURCES.IS_EXTERNAL,
  RESOURCE_DETAILS.PRISROLE,
  RESOURCE_DETAILS.PRUSERTEXT1,
  RESOURCE_DETAILS.PRUSERTEXT2,
  RESOURCE_DETAILS.PRUSERTEXT3,
  RESOURCE_DETAILS.PRUSERTEXT4,
  PLAN_VALUES.SLICE_DATE,
  PLAN_VALUES.SLICE;